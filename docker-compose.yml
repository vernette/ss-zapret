services:
  ss-zapret:
    image: vernette/ss-zapret:latest
    container_name: zapret-proxy
    restart: unless-stopped
    environment:
      - SS_PORT=${SS_PORT}
      - SS_PASSWORD=${SS_PASSWORD}
      - SS_ENCRYPT_METHOD=${SS_ENCRYPT_METHOD}
      - SS_TIMEOUT=${SS_TIMEOUT}
      - SOCKS_PORT=${SOCKS_PORT}
    ports:
      - "${SS_PORT}:${SS_PORT}"
      - "${SOCKS_PORT}:${SOCKS_PORT}"
    volumes:
      - ./config:/opt/zapret/config
    healthcheck:
      test: [
        "CMD-SHELL",
        "nc -z localhost ${SS_PORT} && nc -z localhost ${SOCKS_PORT} && curl -s --socks5 localhost:${SOCKS_PORT} https://api.ipify.org || exit 1"
      ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    cap_add:
      - NET_ADMIN
